# 变更日志

本文档记录 AtomPPGen 的版本更新历史。

---

## [0.1.0] - 2025-11-30

### 核心功能

**TM 伪化算法**
- 实现 Troullier-Martins 方法生成赝波函数
- 支持 s/p/d 通道，自动处理径向节点符号
- 范数守恒精度达到数值极限（~1e-13）
- 连续性条件可配置（0、1、2 阶导数）

**半局域势反演**
- 从伪波函数反演半局域势 V_l(r)
- 径向节点奇异性保护
- 截断半径处光滑连接
- 内外区连续性验证

**KB 投影子构造**
- Kleinman-Bylander 可分离形式转换
- 局域道自动/手动选择
- 投影子归一化与强度计算
- 多通道一致性检查

**可转移性验证**
- 范数守恒检验（相对误差 < 1e-6）
- 对数导数匹配（Numerov 方法求解径向薛定谔方程）
- 幽灵态检测（能量感知分类，区分 Rydberg 激发态与真幽灵态）
- 元素类型差异化阈值（金属 vs 共价元素）

**数据导出**
- JSON 格式：元数据 + 验证报告
- NPZ 格式：压缩数值数组
- 命名约定规范
- 验证报告嵌入

### 验证方法改进

**幽灵态检测逻辑**
- 实现能量感知分类判据：
  - E > 0：正能散射态（盒态）
  - 0 > E > E_valence - δ：Rydberg 激发态（安全）
  - E < E_valence - δ：潜在危险幽灵态
- 物理意义：Rydberg 激发态证明赝势保留正确长程库仑行为
- Al (LDA) 验证结果：s 通道 0 个真幽灵态，p 通道 1 个

**对数导数匹配**
- 元素类型差异化阈值：
  - 金属元素（Al, Na, Mg）：价区 RMS < 16.0
  - 共价元素（Si, C, N）：价区 RMS < 0.3
- 物理依据：金属软势对能量变化不敏感
- Numerov 方法：O(h^5) 精度

### 测试覆盖

**单元测试**（61 个测试）
- ae_atom: 10 个测试（LDA 求解、网格类型、能量验证）
- tm: 11 个测试（s/p 伪化、范数守恒、rc 微扰稳定性）
- invert: 8 个测试（s/p 势反演、节点保护、连续性）
- kb: 6 个测试（KB 转换、归一化、D=W/Z 验证）
- validate: 13 个测试（范数、对数导数、幽灵态、盒态过滤）
- export: 13 个测试（JSON/NPZ、命名约定、L-channel 检查）

**参数扫描验证**
- 测试 9 组 rc 组合（rc_s ∈ [2.0, 2.2], rc_p ∈ [2.2, 2.4], rc_d = 2.4）
- 所有组合通过验收标准（范数 < 1e-6, RMS < 16.0, ghosts ≤ 10）
- 推荐参数：(rc_s, rc_p, rc_d) = (2.1, 2.2, 2.4) Bohr

### 文档

**Sphinx 文档系统**
- 算法原理（TM 方法、势反演、KB 形式、验证方法）
- API 参考（所有公共函数与数据类）
- 用户指南（参数选择、验证标准）
- 验证结果（Al LDA 参数扫描、幽灵态分析、p 通道修复对比）

**示例脚本**
- export_al_example.py：完整工作流示例（AE → TM → 验证 → 导出）
- 参数扫描脚本：自动化测试多组 rc 组合

### 依赖

- AtomSCF >= 0.1.0（全电子原子求解器）
- NumPy >= 1.20
- SciPy >= 1.7

### 已知限制

- 仅支持 LDA 泛函（Perdew-Zunger 1981）
- 单投影子 KB 形式（每通道一个投影子）
- JSON/NPZ 输出格式（UPF 待实现）
- Python API 可用，CLI 工具待开发

### 验证数据

**Al (LDA) 推荐参数组合**
- rc_s = 2.1 Bohr, rc_p = 2.2 Bohr, rc_d = 2.4 Bohr
- 局域道：d 通道
- XC 泛函：PZ81 (Perdew-Zunger 1981)

**验证结果**
- 范数守恒误差：~1e-13（所有通道）
- s 通道对数导数 RMS：8.7（< 16.0 金属阈值）
- p 通道对数导数 RMS：0.6（< 16.0 金属阈值）
- 幽灵态数：0（s 通道），1（p 通道）
- 测试覆盖率：100% (61/61)

---

## 许可

MIT License - 教学课程作业，供学习参考。

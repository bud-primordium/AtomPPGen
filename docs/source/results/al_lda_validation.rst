Al (LDA) 验证结果
=================

实验环境
--------

- Python 环境：已安装 AtomPPGen、AtomSCF、numpy、scipy、matplotlib 依赖包。
- 输入脚本：参数扫描脚本，串行执行 AE 求解、TM 伪化、势反演、KB 转换、完整验证流程。
- 数据更新时间：2025-11-30

参数扫描概览
------------

9 组组合覆盖 :math:`r_c^s \in [2.0, 2.2]`、:math:`r_c^p \in [2.2, 2.4]`、:math:`r_c^d = 2.4`。核心指标如下：

.. list-table:: 扫描统计
   :header-rows: 1

   * - 指标
     - 观测值
     - 解读
   * - 最大范数误差
     - :math:`1.08 \times 10^{-13}`
     - TM 求解器在所有通道内达到数值极限，满足 ``norm_error < 1e-6``。
   * - s 通道 L_RMS
     - 8.50 - 8.80
     - 金属阈值 :math:`16` 内，曲线呈平台状；继续减小 :math:`r_c^s` 有助于降低 RMS。
   * - p 通道 L_RMS
     - 0.60 - 0.61
     - 显著优于金属阈值，说明修正符号处理后能准确匹配 3p 相位。
   * - 幽灵态总数
     - 1 (s:0, p:1)
     - 采用能量感知分类后，s 通道无真幽灵态，检出的束缚态均为 Rydberg 激发态序列或盒态。

幽灵态检测改进
--------------

初步检测在能量窗口 :math:`E \in [-0.15, +0.05]` Ha 内报告了 s 通道 10 个"深幽灵态"。
经过能量分析，发现这些态能量全部高于 3s 价态 (:math:`\varepsilon_{3s} \approx -0.247` Ha)，
其物理本质为：

1. **Rydberg 激发态序列**：能量趋于电离阈值 (0 Ha) 的高主量子数束缚态 (4s, 5s, 6s...)，
   距离费米能级约 0.24 Ha (6.5 eV)，对基态 DFT 无影响。

2. **盒态散射谱**：有限网格 (:math:`R_{\max} = 100` Bohr) 导致的连续谱离散化，
   数学上属于散射态而非真正束缚态。

**分类判据改进**：

原先仅基于尾部比例 :math:`\tau = |\psi(R_{\max})|/\max|\psi|` 判定盒态，未考虑能量位置。
改进后引入能量感知分类：

- :math:`E > 0`：正能散射态（盒态）
- :math:`0 > E > \varepsilon_{\text{valence}} - \delta`：Rydberg 激发态（安全）
- :math:`E < \varepsilon_{\text{valence}} - \delta`：潜在危险幽灵态（需二次检验 :math:`\tau`）

其中 :math:`\delta = 0.01` Ha 为能量容差。修正后，s 通道真幽灵态数为 **0**，验证了
TM 赝势保留了正确的长程库仑行为 (:math:`-1/r`)。

**检出态分类** (:math:`r_c^s = 2.1`)：

.. list-table::
   :header-rows: 1

   * - 能量范围 (Ha)
     - 数量
     - 分类
     - 物理意义
   * - :math:`-0.011 \sim -0.001`
     - 3
     - Rydberg 态
     - 4s, 5s, 6s 激发态
   * - :math:`+0.001 \sim +0.030`
     - 7
     - 散射态
     - 盒态离散化产物
   * - :math:`+0.036 \sim +0.045`
     - 2
     - 盒态
     - :math:`\tau > 0.1`，边界效应

p 通道修复前后对比
------------------

最初的 p 通道 TM 伪化因符号缺失导致范数守恒失效。修复径向节点符号处理后，
范数误差回落到数值级别。主要指标对比如下：

.. list-table:: p 通道修复效果
   :header-rows: 1

   * - 场景
     - 范数误差
     - 备注
   * - 修复前 (rc=2.2)
     - 1.74e-02
     - 数值溢出，验证失败。
   * - 修复前 (rc=2.3)
     - 1.87e-02
     - 随 :math:`r_c` 增大误差进一步恶化，KB 投影无法生成。
   * - 修复前 (rc=2.4)
     - 9.67e-01
     - 伪化能量被推入极端区域，触发警告。
   * - 修复后 (rc=2.2)
     - 1.08e-13
     - 范数检验通过，对数导数曲线重合。
   * - 修复后 (rc=2.3)
     - 1.31e-16
     - TM 多项式稳定，零点对齐。
   * - 修复后 (rc=2.4)
     - 4.51e-15
     - 范数守恒保持，符号处理对大 :math:`r_c` 同样适用。

验证迁移建议
------------

1. 使用验证报告的摘要功能生成 Markdown 格式结果，便于文档集成。
2. 在平面波代码（如 Quantum ESPRESSO）中测试赝势，建议截断能量
   ``ecutwfc = 35`` Ry、``ecutrho = 280`` Ry。
3. 扩展至其他元素（Si、Mg 等）时，可复用本章结构：参数扫描表、幽灵态分类、
   修复对比与可视化图表，形成统一的验证档案。

推荐参数组合
------------

综合范数守恒、对数导数匹配、幽灵态检测结果，推荐以下参数作为教学示例起点：

- :math:`(r_c^s, r_c^p, r_c^d) = (2.1, 2.2, 2.4)` Bohr
- 局域道选择：d 通道
- XC 泛函：LDA (Perdew-Zunger 1981)

该组合确保 p 通道相位精确、s 通道无幽灵态风险、范数守恒达到数值极限。
